#pragma warning disable 1591
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.42000
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

namespace ASP
{
    using System;
    using System.Collections.Generic;
    using System.Globalization;
    using System.IO;
    using System.Linq;
    using System.Net;
    using System.Text;
    using System.Web;
    using System.Web.Helpers;
    using System.Web.Mvc;
    using System.Web.Mvc.Ajax;
    using System.Web.Mvc.Html;
    using System.Web.Optimization;
    using System.Web.Routing;
    using System.Web.Security;
    using System.Web.UI;
    using System.Web.WebPages;
    using HtmlHelpers.BeginCollectionItem;
    using Webmall.UI;
    
    #line 1 "..\..\Views\Shared\AddToCartScript.cshtml"
    using Webmall.UI.Core;
    
    #line default
    #line hidden
    using Webmall.UI.Core.Localization;
    
    [System.CodeDom.Compiler.GeneratedCodeAttribute("RazorGenerator", "2.0.0.0")]
    [System.Web.WebPages.PageVirtualPathAttribute("~/Views/Shared/AddToCartScript.cshtml")]
    public partial class _Views_Shared_AddToCartScript_cshtml : System.Web.Mvc.WebViewPage<dynamic>
    {
        public _Views_Shared_AddToCartScript_cshtml()
        {
        }
        public override void Execute()
        {
WriteLiteral("\r\n");

            
            #line 3 "..\..\Views\Shared\AddToCartScript.cshtml"
  
    var valute = SessionHelper.CurrentValute.Code;

            
            #line default
            #line hidden
WriteLiteral("\r\n\r\n");

WriteLiteral("\r\n");

WriteLiteral("\r\n");

            
            #line 9 "..\..\Views\Shared\AddToCartScript.cshtml"
Write(Scripts.Render("~/bundles/notify"));

            
            #line default
            #line hidden
WriteLiteral("\r\n<script");

WriteLiteral(" type=\"text/javascript\"");

WriteLiteral(@">

    var lastKeyPressed = -1;
    let addToCartDialog;

    $(function() {
        $(document).keydown(function(event) {
            lastKeyPressed = event.keyCode;
        });

        addToCartDialog = new Modal({
            content: document.querySelector('#pop-up-addToCartDialog'),
            className: 'modal-win__body--wide'
        });
    });

    function JumpOnKeyEnter(ctrl) {
        if (lastKeyPressed == 13) {
            UpdateCart(ctrl);
            return false;
        } else return true;
    }

    function CloseCartDialog() {
        addToCartDialog.close();
    }

    ");

WriteLiteral("\r\n    /* LazyLoadScript */\r\n    function LazyShortPropertiesFun() {\r\n        /* G" +
"o To Full Params Tab */\r\n        let toggle = document.querySelector(\'[data-goto" +
"-tab]\');\r\n\r\n        if (toggle) {\r\n            toggle.addEventListener(\'click\', " +
"function (e) {\r\n                let hash = this.dataset.gotoTab;\r\n\r\n            " +
"    let hashTab = document.querySelector(\'.tabs__link[href=\"\' + hash + \'\"]\');\r\n " +
"               let hashAccordion = document.querySelector(hash);\r\n\r\n            " +
"    if (hashTab) {\r\n                    let ev = new Event(\'click\');\r\n          " +
"          hashTab.dispatchEvent(ev);\r\n                }\r\n\r\n                if (h" +
"ashAccordion) {\r\n                    document.querySelectorAll(\'.tabs__tab-pane\'" +
").forEach(function (item) {\r\n                        item.classList.remove(\'is-o" +
"pened\');\r\n                    });\r\n\r\n                    hashAccordion.parentNod" +
"e.classList.add(\'is-opened\');\r\n                }\r\n\r\n                e.preventDef" +
"ault();\r\n            });\r\n        }\r\n        /* Go To Full Params Tab */\r\n    }\r" +
"\n\r\n    function LazyOfferFun(pannelId) {\r\n        initSliders();\r\n\r\n        AddC" +
"ounterListener(document.getElementById(pannelId));\r\n        InitGallery(document" +
".getElementById(pannelId));\r\n\r\n        $(\".stock-table__product-img\").click(imag" +
"eLoader);\r\n        $(\"[name=\'query\']\").bind(\"change keyup input paste\", filterSe" +
"ction);\r\n        $(\"[name=\'query\']\").keydown(preventSubmit);\r\n    }\r\n\r\n    funct" +
"ion LazyRelatedFun() {\r\n\r\n        var instance = document.querySelector(\"#lazyRe" +
"lated .swiper\");\r\n        initializeCarouselInstance(instance);\r\n    }\r\n\r\n    fu" +
"nction InitGallery(block) {\r\n        block.querySelectorAll(\'.spec-helpers\').for" +
"Each((item) => {\r\n            lightGallery(item, {\r\n                selector: \'." +
"js-single-gallery\'\r\n            });\r\n        });\r\n    }\r\n    //function LazyBest" +
"OfferFun(pannelId) {\r\n    //    AddCounterListener(document.getElementById(panne" +
"lId));\r\n    //}\r\n    //function LazyWarehouseOffersFun(pannelId) {\r\n    //    Ad" +
"dCounterListener(document.getElementById(pannelId));\r\n    //    InitGallery(docu" +
"ment.getElementById(pannelId));\r\n    //}\r\n    //function LazyNonWarehouseOffersF" +
"un(pannelId) {\r\n    //    AddCounterListener(document.getElementById(pannelId));" +
"\r\n    //    InitGallery(document.getElementById(pannelId));\r\n    //}\r\n    //func" +
"tion LazyAnalogsFun(pannelId) {\r\n    //    AddCounterListener(document.getElemen" +
"tById(pannelId));\r\n    //    InitGallery(document.getElementById(pannelId));\r\n  " +
"  //}\r\n\r\n    function AddCounterListener(block) {\r\n        /* ------------ Count" +
"er ------------ */\r\n        block.querySelectorAll(\'.counter__btn--add\').forEach" +
"(function (item) {\r\n            item.addEventListener(\'click\', function (e) {\r\n " +
"               const input = this.closest(\'.counter\').querySelector(\'input[type=" +
"\"tel\"]\');\r\n                const value = input.value;\r\n\r\n                if (!pa" +
"rseInt(value) === value) return;\r\n                if (parseInt(input.value) >= 9" +
"99) return;\r\n                if (parseInt(input.value) < 1) {\r\n                 " +
"   input.value = 1;\r\n                    return;\r\n                }\r\n           " +
"     if (parseInt(input.value) >= input.max) {\r\n                    input.value " +
"= input.max;\r\n                    return;\r\n                }\r\n\r\n                " +
"input.value = parseInt(value) + 1;\r\n\r\n                e.preventDefault();\r\n     " +
"       });\r\n        });\r\n\r\n        block.querySelectorAll(\'.counter__btn--remove" +
"\').forEach(function (item) {\r\n            item.addEventListener(\'click\', functio" +
"n (e) {\r\n                const input = this.closest(\'.counter\').querySelector(\'i" +
"nput[type=\"tel\"]\');\r\n                const value = input.value;\r\n\r\n             " +
"   if (!parseInt(value) === value) return;\r\n                if (parseInt(input.v" +
"alue) < 1) {\r\n                    input.value = 1;\r\n                    return;\r" +
"\n                }\r\n                if (parseInt(input.value) <= input.min) {\r\n " +
"                   input.value = input.min;\r\n                    return;\r\n      " +
"          }\r\n                if (value > 1) {\r\n                    input.value =" +
" parseInt(value) - 1;\r\n                }\r\n\r\n                e.preventDefault();\r" +
"\n            });\r\n        });\r\n        /* ------------ Counter ------------ */\r\n" +
"    }\r\n    /* LazyLoadScript */\r\n\r\n    function AddToCartLocal(el, wareId, offer" +
"Id, price, article, producer) {\r\n        var findInput = $(el).parent().parent()" +
".find(\'[data-cartQt=\"\' + offerId + \'\"]\')[0];\r\n        var qnt = $(\'[data-cartQt=" +
"\"\' + offerId + \'\"]\').val();\r\n        event.preventDefault();\r\n\r\n        if (find" +
"Input != undefined) qnt = $(findInput).val();\r\n        var url = \'");

            
            #line 233 "..\..\Views\Shared\AddToCartScript.cshtml"
              Write(Url.Action("AddCartToStoreOrLocalStorage", "Cart"));

            
            #line default
            #line hidden
WriteLiteral("\' + \'?wareId=\' + wareId + \'&offerId=\' + offerId + \'&article=\' + article + \'&produ" +
"cer=\' + producer + \'&offerQnt=\' + qnt + \'&price=\' + price + \'&isLocalStorage=tru" +
"e\';\r\n\r\n        $.post(url, null, function (data) {\r\n            var localCart = " +
"localStorage.getItem(\'cart\');\r\n            var totalProdStorage = [];\r\n         " +
"   var totalPrice = 0;\r\n            var totalCount = localCart != null ? JSON.pa" +
"rse(localCart).length : 0;\r\n\r\n            if (data.message) {\r\n                S" +
"howErrorAddToCart(data.message);\r\n                return;\r\n            }\r\n      " +
"      if (localCart == null) {\r\n                localStorage.setItem(\'cart\', JSO" +
"N.stringify(data.carts));\r\n                totalProdStorage.push(data.carts[0]);" +
"\r\n                totalCount += 1;\r\n            }\r\n            else {\r\n         " +
"       var isHaveElement = false;\r\n                totalProdStorage = JSON.parse" +
"(localCart);\r\n                totalProdStorage.forEach(function (elem) {\r\n      " +
"              if (elem.OfferId == data.carts[0].OfferId) {\r\n                    " +
"    isHaveElement = true;\r\n                        elem.WareQnt += data.carts[0]" +
".WareQnt;\r\n                    }\r\n                });\r\n                if (!isHa" +
"veElement) {\r\n                    totalProdStorage.push(data.carts[0]);\r\n       " +
"             totalCount += 1;\r\n                }\r\n                localStorage.s" +
"etItem(\'cart\', JSON.stringify(totalProdStorage));\r\n            }\r\n\r\n            " +
"addToCartDialog.open();\r\n\r\n            var currentQnt = 0;\r\n            totalPro" +
"dStorage.forEach(function (elem) {\r\n                totalPrice += (elem.ClientPr" +
"ice * elem.WareQnt);\r\n                if (elem.OfferId === offerId)\r\n           " +
"         currentQnt = elem.warehouseQnt;\r\n            });\r\n\r\n            $(\".car" +
"t-text\").html(totalPrice.toFixed(2) + \" ");

            
            #line 275 "..\..\Views\Shared\AddToCartScript.cshtml"
                                                       Write(valute);

            
            #line default
            #line hidden
WriteLiteral(@""");
            $("".cart-counter"").html(totalCount);
            var inCart = el.querySelector('.in-cart');
            inCart.innerHTML = currentQnt; 
            inCart.removeAttribute(""hidden"");

            setTimeout(function () {
                addToCartDialog.close();
            }, 2000);
        });
    }

    function AddToCart(el, wareId, offerId, price, article, producer) {
        var qnt = $('[data-cartQt=""' + offerId + '""]').val();
        var url = '");

            
            #line 289 "..\..\Views\Shared\AddToCartScript.cshtml"
              Write(Url.Action("AddCartToStoreOrLocalStorage", "Cart"));

            
            #line default
            #line hidden
WriteLiteral(@"' + '?wareId=' + wareId + '&offerId=' + offerId + '&article=' + article + '&producer=' + producer + '&offerQnt=' + qnt + '&price=' + price + '&isLocalStorage=false';
        event.preventDefault();
        $.post(url, el.dataset.offer,
            function(data) {

                if (data.message) {
                    ShowErrorAddToCart(data.message);
                    return;
                }
                var totalProdStorage = [];
                var totalPrice = 0;
                var totalCount = 0;

                data.carts.forEach((el) => { totalProdStorage.push(el) });

                addToCartDialog.open();

                var currentQnt = 0;
                totalProdStorage.forEach(function(elem) {
                    totalPrice += (elem.ClientPrice * elem.WareQnt);
                    totalCount += 1;
                    if (elem.OfferId === offerId)
                        currentQnt = elem.WareQnt;
                });

                $("".cart-text"").html(totalPrice.toFixed(2) + "" ");

            
            #line 314 "..\..\Views\Shared\AddToCartScript.cshtml"
                                                           Write(valute);

            
            #line default
            #line hidden
WriteLiteral(@""");
                $("".cart-counter"").html(totalCount);

                var inCart = el.querySelector('.in-cart');
                inCart.innerHTML = currentQnt; 
                inCart.removeAttribute(""hidden"");

                setTimeout(function() {
                        addToCartDialog.close();
                    },
                    2000);
            });
    }

    function ShowErrorAddToCart(message) {
        var titleOld = $("".modal-win__title"").text();
        $("".modal-win__title"").text(message);
        $("".product-added-footer"").hide();
        addToCartDialog.open();
        setTimeout(function() {
                addToCartDialog.close();
                $("".modal-win__title"").text(titleOld);
                $("".product-added-footer"").show();
            },
            2000);
    }

    function setCartFromLocal() {
        var localCart = localStorage.getItem('cart');
        if (localCart != null) {
            var totalProdStorage = JSON.parse(localCart);
            var totalPrice = 0;
            var totalCount = totalProdStorage.length;
            totalProdStorage.forEach(function(elem) {
                totalPrice += (elem.ClientPrice * elem.WareQnt);
            });

            $("".cart-text"").html(totalPrice.toFixed(2) + "" ");

            
            #line 351 "..\..\Views\Shared\AddToCartScript.cshtml"
                                                       Write(valute);

            
            #line default
            #line hidden
WriteLiteral("\");\r\n            $(\".cart-counter\").html(totalCount);\r\n        }\r\n    }\r\n\r\n");

            
            #line 356 "..\..\Views\Shared\AddToCartScript.cshtml"
    
            
            #line default
            #line hidden
            
            #line 356 "..\..\Views\Shared\AddToCartScript.cshtml"
     if (SessionHelper.CurrentUser == null)
    {

            
            #line default
            #line hidden
WriteLiteral("        ");

WriteLiteral("\r\n            setCartFromLocal();\r\n        ");

WriteLiteral("\r\n");

            
            #line 361 "..\..\Views\Shared\AddToCartScript.cshtml"
    }

            
            #line default
            #line hidden
WriteLiteral("\r\n</script>\r\n");

WriteLiteral("\r\n");

        }
    }
}
#pragma warning restore 1591
